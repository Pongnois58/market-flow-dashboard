<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trader Market Flow Radar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #020617;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 24px;
    }
    .container { max-width: 1200px; width: 100%; }

    .header {
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      flex-wrap: wrap;
    }
    .title-block { max-width: 800px; }
    .title { font-size: 28px; font-weight: 700; margin-bottom: 4px; }
    .subtitle { font-size: 14px; color: #9ca3af; white-space: pre-line; }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.2fr);
      grid-gap: 20px;
      margin-bottom: 16px;
    }
    .card {
      background: radial-gradient(circle at top left, #1e293b, #020617);
      border-radius: 16px;
      padding: 18px 20px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.8);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 8px;
    }
    .card-title { font-size: 16px; font-weight: 600; }
    .badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.2);
      color: #e5e7eb;
      white-space: nowrap;
    }
    .chart-container { height: 260px; position: relative; }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
      font-size: 11px;
      color: #9ca3af;
    }
    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .legend-color {
      width: 10px;
      height: 10px;
      border-radius: 3px;
      background: #38bdf8;
    }
    .legend-color.dxy { background: #a855f7; }
    .legend-color.es  { background: #38bdf8; }
    .legend-color.nq  { background: #0ea5e9; }
    .legend-color.gc  { background: #facc15; }
    .legend-color.btc { background: #fb923c; }
    .legend-color.eth { background: #22c55e; }

    .stats-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      font-size: 11px;
      color: #9ca3af;
      flex-wrap: wrap;
    }
    .stat-pill {
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(75, 85, 99, 0.8);
    }

    .flow-score { font-size: 34px; font-weight: 700; margin-bottom: 4px; }
    .flow-label { font-size: 13px; font-weight: 600; margin-bottom: 8px; }
    .flow-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
      margin-bottom: 10px;
    }
    .flow-chip span.emoji { font-size: 14px; }
    .flow-desc {
      font-size: 12px;
      color: #9ca3af;
      line-height: 1.5;
      margin-bottom: 8px;
      white-space: pre-line;
    }
    .flow-list {
      font-size: 12px;
      color: #e5e7eb;
      margin-top: 4px;
      padding-left: 14px;
    }
    .flow-list li { margin-bottom: 2px; }

    .suggestion-box {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px dashed rgba(75, 85, 99, 0.9);
      font-size: 11.5px;
    }
    .suggestion-title { font-weight: 600; margin-bottom: 4px; font-size: 12px; }
    .suggestion-asset { font-weight: 600; }
    .suggestion-note { margin-top: 6px; color: #9ca3af; font-size: 10.5px; }

    .actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 12px;
      gap: 8px;
    }
    button {
      border: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 12px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15, 23, 42, 1);
      color: #e5e7eb;
      border: 1px solid rgba(75, 85, 99, 1);
    }
    button:hover { background: rgba(15, 23, 42, 0.75); }

    .footer {
      margin-top: 6px;
      font-size: 11px;
      color: #6b7280;
      text-align: right;
      white-space: pre-line;
    }

    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; }
      .header { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <header class="header">
      <div class="title-block">
        <div class="title" id="titleText">Trader Market Flow Radar</div>
        <div class="subtitle" id="subtitleText">
Prototype website for traders â€” track money flow across DXY, ES, NQ, GC, BTC, ETH
to estimate whether the market is in Risk-On, Risk-Off, or Stay Out mode.
        </div>
      </div>
    </header>

    <main>
      <div class="grid">
        <!-- LEFT: CHART -->
        <section class="card">
          <div class="card-header">
            <div class="card-title" id="chartTitle">Cross-Asset % Change Snapshot</div>
            <div class="badge" id="dataSourceBadge">Demo Data â€¢ Intraday</div>
          </div>

          <div class="chart-container">
            <canvas id="marketChart"></canvas>
          </div>

          <div class="legend">
            <span class="legend-item"><span class="legend-color dxy"></span>DXY</span>
            <span class="legend-item"><span class="legend-color es"></span>ES</span>
            <span class="legend-item"><span class="legend-color nq"></span>NQ</span>
            <span class="legend-item"><span class="legend-color gc"></span>GC</span>
            <span class="legend-item"><span class="legend-color btc"></span>BTC</span>
            <span class="legend-item"><span class="legend-color eth"></span>ETH</span>
          </div>

          <div class="stats-row" id="statsRow"></div>
        </section>

        <!-- RIGHT: FLOW + SUGGESTION -->
        <section class="card">
          <div class="card-header">
            <div class="card-title" id="flowTitle">Risk-On / Risk-Off Flow Score</div>
            <div class="badge" id="flowBadge">0â€“100 â€¢ Educational Only</div>
          </div>

          <div id="flowScore" class="flow-score">â€“</div>
          <div id="flowLabel" class="flow-label">Loadingâ€¦</div>
          <div id="flowChip" class="flow-chip">
            <span class="emoji">ðŸ•’</span>
            <span id="flowChipText">Evaluating current regimeâ€¦</span>
          </div>

          <div id="flowDesc" class="flow-desc"></div>
          <ul id="flowList" class="flow-list"></ul>

          <div class="suggestion-box">
            <div class="suggestion-title" id="suggestionTitle">Smart Focus (DEMO Recommendation)</div>
            <div id="suggestionText">
              The system picks the strongest risk asset and the strongest defensive asset based on today's flows.
            </div>
            <div class="suggestion-note" id="suggestionNote">
              * For educational purposes only. Not financial advice or a guarantee of profits.
            </div>
          </div>

          <div class="actions">
            <button id="randomBtn">ðŸŽ² Randomize Demo</button>
          </div>
        </section>
      </div>

      <div class="footer" id="footerText">
Prototype for class presentation â€” can be extended to use real-time API data and live charts in future versions.
      </div>
    </main>
  </div>

  <script>
    // Single-language text config
    const T = {
      pillVolHigh: "Vol > Avg",
      pillVolLow: "Vol â‰¤ Avg",
      labelRiskOn: "RISK-ON regime â€“ money flowing into risk assets",
      labelNeutral: "Neutral regime â€“ flows mixed on both sides",
      labelRiskOff: "RISK-OFF regime â€“ money rotating into USD/Gold",
      chipRiskOn: "Aggressive / Pro-Risk",
      chipNeutral: "Neutral / Wait & See",
      chipRiskOff: "Defensive / Hedge Mode",
      marketModeOn: "Market is leaning toward the risk-on side.",
      marketModeMid: "Market has no clear bias yet (flows are mixed).",
      marketModeOff: "Market is leaning toward risk-off / protection mode.",
      bullets: {
        dxyUp: "DXY up strongly â†’ stronger USD, pressure on risk assets.",
        dxyDown: "DXY weaker â†’ supportive backdrop for risk-on trades.",
        esNqUp: "ES/NQ up â†’ money flowing into US equities, especially growth/tech via NQ.",
        esNqDown: "ES/NQ down â†’ equities under profit-taking or risk-off pressure.",
        gcUp: "Gold (GC) up â†’ higher demand for hedging and safety.",
        gcDown: "Gold (GC) down â†’ investors more willing to take risk.",
        cryptoUp: "BTC/ETH strong â†’ appetite for high beta / crypto risk is high.",
        cryptoDown: "Crypto selling off â†’ sentiment on high-risk assets is cooling.",
        noClear: "Moves are not very clear â†’ better to be patient or trade only small intraday setups.",
      },
      suggestionIntro:
        "The system picks the strongest risk asset and the strongest defensive asset based on today's flows.",
      suggestionNeutral:
        "Market looks choppy or directionless â†’ this is a good time to stay on the sidelines or trade very small size.\nIf you take trades, focus on high RR setups only and wait for clear signals from your main strategy.",
      suggestionRiskPrefix:
        "If you want to play the Aggressive / Risk-On side, you may focus on:",
      suggestionDefPrefix:
        "If you want to stay Defensive / Hedge-focused, you may watch:",
      suggestionStayOut: "Stay Out / Low Exposure Mode:",
    };

    // DEMO market data
    let marketData = {
      dxy: { name: "DXY", change: 0.4, vol: 105, volAvg: 100, type: "defensive" },
      es:  { name: "ES",  change: 0.8, vol: 120, volAvg: 100, type: "risk" },
      nq:  { name: "NQ",  change: 1.2, vol: 135, volAvg: 100, type: "risk" },
      gc:  { name: "GC",  change: -0.3, vol: 95,  volAvg: 100, type: "defensive" },
      btc: { name: "BTC", change: 2.5, vol: 150, volAvg: 100, type: "risk" },
      eth: { name: "ETH", change: 3.1, vol: 160, volAvg: 100, type: "risk" },
    };

    let chartInstance = null;

    // FLOW SCORE
    function computeFlowScore(data) {
      const dxy = data.dxy.change;
      const es  = data.es.change;
      const nq  = data.nq.change;
      const gc  = data.gc.change;
      const btc = data.btc.change;
      const eth = data.eth.change;

      let score =
        50 +
        (es + nq) * 4 +
        (btc + eth) * 2.5 -
        dxy * 5 -
        gc * 3;

      if (score > 100) score = 100;
      if (score < 0) score = 0;
      return Math.round(score);
    }

    function getFlowLabel(score) {
      if (score >= 70) return T.labelRiskOn;
      if (score >= 40) return T.labelNeutral;
      return T.labelRiskOff;
    }

    function getFlowChip(score) {
      if (score >= 70) return { emoji: "ðŸŸ¢", text: T.chipRiskOn };
      if (score >= 40) return { emoji: "ðŸŸ¡", text: T.chipNeutral };
      return { emoji: "ðŸ”´", text: T.chipRiskOff };
    }

    function buildFlowDesc(score, data) {
      const { dxy, es, nq, gc, btc, eth } = data;
      let modeText;
      if (score >= 70) modeText = T.marketModeOn;
      else if (score >= 40) modeText = T.marketModeMid;
      else modeText = T.marketModeOff;

      return (
        `${modeText}\n\n` +
        `â€¢ DXY: ${dxy.change.toFixed(2)}%\n` +
        `â€¢ ES: ${es.change.toFixed(2)}%\n` +
        `â€¢ NQ: ${nq.change.toFixed(2)}%\n` +
        `â€¢ GC: ${gc.change.toFixed(2)}%\n` +
        `â€¢ BTC: ${btc.change.toFixed(2)}%\n` +
        `â€¢ ETH: ${eth.change.toFixed(2)}%\n`
      );
    }

    function buildFlowBullets(score, data) {
      const b = T.bullets;
      const { dxy, es, nq, gc, btc, eth } = data;
      const bullets = [];

      if (dxy.change > 0.5) bullets.push(b.dxyUp);
      else if (dxy.change < -0.3) bullets.push(b.dxyDown);

      if (es.change > 0.5 || nq.change > 0.5) bullets.push(b.esNqUp);
      else if (es.change < -0.5 || nq.change < -0.5) bullets.push(b.esNqDown);

      if (gc.change > 0.4) bullets.push(b.gcUp);
      else if (gc.change < -0.3) bullets.push(b.gcDown);

      if (btc.change > 1 || eth.change > 1.5) bullets.push(b.cryptoUp);
      else if (btc.change < -1 || eth.change < -1.5) bullets.push(b.cryptoDown);

      if (bullets.length === 0) bullets.push(b.noClear);
      return bullets;
    }

    // RECOMMENDATION
    function buildSuggestions(data) {
      const assets = Object.values(data);
      const riskAssets = assets.filter(a => a.type === "risk");
      const defensiveAssets = assets.filter(a => a.type === "defensive");
      const calcMomentum = a => a.change * (a.vol / a.volAvg);

      let bestRisk = riskAssets[0];
      let bestDef = defensiveAssets[0];

      riskAssets.forEach(a => {
        if (calcMomentum(a) > calcMomentum(bestRisk)) bestRisk = a;
      });
      defensiveAssets.forEach(a => {
        if (calcMomentum(a) > calcMomentum(bestDef)) bestDef = a;
      });

      return {
        riskName: bestRisk.name,
        riskChange: bestRisk.change,
        defName: bestDef.name,
        defChange: bestDef.change,
      };
    }

    function updateSuggestionBox(score) {
      const s = buildSuggestions(marketData);
      const box = document.getElementById("suggestionText");

      const nearNeutral = Math.abs(score - 50) <= 10;

      if (nearNeutral) {
        box.innerHTML =
          `<div class="suggestion-asset">${T.suggestionStayOut}</div>` +
          `<div style="margin-top:4px;">${T.suggestionNeutral.replace(/\n/g, "<br>")}</div>`;
      } else {
        box.innerHTML =
          `${T.suggestionIntro}<br><br>` +
          `${T.suggestionRiskPrefix}<br>` +
          `â€¢ <span class="suggestion-asset">${s.riskName}</span> (${s.riskChange.toFixed(2)}%)<br><br>` +
          `${T.suggestionDefPrefix}<br>` +
          `â€¢ <span class="suggestion-asset">${s.defName}</span> (${s.defChange.toFixed(2)}%)`;
      }
    }

    // CHART
    function renderChart(data) {
      const canvas = document.getElementById("marketChart");
      if (!canvas || typeof Chart === "undefined") {
        console.log("Chart.js not available, skip chart.");
        renderStatsRow(data);
        return;
      }
      const ctx = canvas.getContext("2d");
      const labels = ["DXY", "ES", "NQ", "GC", "BTC", "ETH"];
      const changes = [
        data.dxy.change,
        data.es.change,
        data.nq.change,
        data.gc.change,
        data.btc.change,
        data.eth.change,
      ];

      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [
            {
              label: "% Change",
              data: changes,
              backgroundColor: [
                "rgba(168, 85, 247, 0.9)", // DXY
                "rgba(56, 189, 248, 0.9)", // ES
                "rgba(14, 165, 233, 0.9)", // NQ
                "rgba(250, 204, 21, 0.9)", // GC
                "rgba(251, 146, 60, 0.9)", // BTC
                "rgba(34, 197, 94, 0.9)",  // ETH
              ],
              borderWidth: 0,
              borderRadius: 6,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            x: {
              ticks: { color: "#9ca3af", font: { size: 11 } },
              grid: { display: false },
            },
            y: {
              ticks: {
                color: "#6b7280",
                font: { size: 11 },
                callback: (v) => v + "%",
              },
              grid: { color: "rgba(55, 65, 81, 0.5)" },
            },
          },
        },
      });

      renderStatsRow(data);
    }

    function renderStatsRow(data) {
      const statsRow = document.getElementById("statsRow");
      statsRow.innerHTML = "";
      const arr = [data.dxy, data.es, data.nq, data.gc, data.btc, data.eth];
      arr.forEach((asset) => {
        const pill = document.createElement("div");
        pill.className = "stat-pill";
        const volBias = asset.vol > asset.volAvg ? T.pillVolHigh : T.pillVolLow;
        pill.textContent = `${asset.name}: ${asset.change.toFixed(2)}% â€¢ ${volBias}`;
        statsRow.appendChild(pill);
      });
    }

    function updateFlowPanel() {
      const score = computeFlowScore(marketData);
      const label = getFlowLabel(score);
      const chip = getFlowChip(score);
      const desc = buildFlowDesc(score, marketData);
      const bullets = buildFlowBullets(score, marketData);

      document.getElementById("flowScore").textContent = score + "/100";
      document.getElementById("flowLabel").textContent = label;

      const chipEl = document.getElementById("flowChip");
      chipEl.innerHTML = "";
      const emojiSpan = document.createElement("span");
      emojiSpan.className = "emoji";
      emojiSpan.textContent = chip.emoji;
      const textSpan = document.createElement("span");
      textSpan.textContent = chip.text;
      chipEl.appendChild(emojiSpan);
      chipEl.appendChild(textSpan);

      document.getElementById("flowDesc").textContent = desc;

      const listEl = document.getElementById("flowList");
      listEl.innerHTML = "";
      bullets.forEach((b) => {
        const li = document.createElement("li");
        li.textContent = b;
        listEl.appendChild(li);
      });

      updateSuggestionBox(score);
    }

    // DEMO RANDOMIZER
    function randomizeMarket() {
      function randChange(base, spread) {
        return base + (Math.random() - 0.5) * spread;
      }
      function randVol() {
        return 80 + Math.random() * 60;
      }

      marketData = {
        dxy: { name: "DXY", change: randChange(0, 1.0),  vol: randVol(), volAvg: 100, type: "defensive" },
        es:  { name: "ES",  change: randChange(0.4, 2),  vol: randVol(), volAvg: 100, type: "risk" },
        nq:  { name: "NQ",  change: randChange(0.6, 2.5),vol: randVol(), volAvg: 100, type: "risk" },
        gc:  { name: "GC",  change: randChange(0, 1.5),   vol: randVol(), volAvg: 100, type: "defensive" },
        btc: { name: "BTC", change: randChange(1.0, 7.0), vol: randVol(), volAvg: 100, type: "risk" },
        eth: { name: "ETH", change: randChange(1.2, 8.0), vol: randVol(), volAvg: 100, type: "risk" },
      };

      renderChart(marketData);
      updateFlowPanel();

      document.getElementById("dataSourceBadge").textContent =
        "Demo Data â€¢ Randomized snapshot";
    }

    // INIT
    function initDashboard() {
      renderChart(marketData);
      updateFlowPanel();

      document.getElementById("randomBtn").addEventListener("click", () => {
        randomizeMarket();
      });
    }

    document.addEventListener("DOMContentLoaded", initDashboard);
  </script>
</body>
</html>
